<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Royal Event System (Final Pro)</title>
    <style id="ctrl-font-style">
        @font-face { font-family: 'Faruuma'; src: local('Faruuma'), url('Fonts/faruuma.ttf') format('truetype'); }
        body, input, textarea, select, button { font-family: 'Faruuma', sans-serif; }
    </style>
    
    <style>
        /* --- SECURITY & UI --- */
        body { 
            -webkit-user-select: none; user-select: none;
            background: #eceff1; padding: 10px; margin: 0; 
            height: 100vh; box-sizing: border-box; overflow: hidden; 
        }
        
        .main-layout { display: flex; gap: 15px; height: 96vh; max-width: 100%; margin: 0 auto; }

        .sidebar {
            flex: 0 0 310px; background: white; padding: 15px; border-radius: 8px;
            display: flex; flex-direction: column;
            border-top: 5px solid #004d40; box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        .editor {
            flex: 1; background: white; padding: 25px; border-radius: 8px;
            border-top: 5px solid #b8860b; box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; overflow-y: auto;
        }

        h2 { margin-top: 0; color: #004d40; text-align: center; font-size: 18px; border-bottom: 2px solid #eee; padding-bottom: 10px;}

        .launch-btn { 
            background: #b8860b; color: white; padding: 12px; width: 100%; 
            border: none; border-radius: 5px; cursor: pointer; font-weight: bold; 
            font-size: 16px; margin-bottom: 10px;
            border-bottom: 3px solid #8b6508;
        }
        .launch-btn:active { transform: translateY(2px); border-bottom: 1px solid #8b6508; }

        .file-box { background: #fdfbe6; padding: 10px; border-radius: 5px; border: 1px solid #f0e68c; margin-bottom: 8px; }
        label { display: block; font-weight: bold; font-size: 13px; margin-bottom: 3px; color: #333; }
        input[type="file"] { width: 100%; font-size: 11px; margin-bottom: 5px; cursor: pointer; }

        input[type="text"], textarea { 
            width: 98%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; 
            font-size: 20px; margin-bottom: 10px;
            text-align: center; background: #fafafa; direction: rtl; user-select: text;
        }
        input[type="text"]:focus, textarea:focus { border-color: #b8860b; outline: none; background: #fff; }
        
        .sub-input { font-size: 16px !important; padding: 8px !important; margin-bottom: 5px !important; border-color: #eee !important; }
        textarea { resize: vertical; min-height: 120px; line-height: 1.6; font-size: 24px !important; }
        select { width: 100%; font-size: 14px; outline: none; border-color: #004d40; margin-bottom: 10px; }

        .controls { display: flex; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; }
        button.action { flex: 1; padding: 15px; font-size: 18px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; }
        .btn-live { background: #004d40; flex: 2; border: 2px solid #ffd700; color: #ffd700; font-size: 22px; }
        .btn-nav { background: #546e7a; }
        .btn-clear { background: #c62828; flex: 0.5; color: white; }

        #statusMsg { text-align: center; margin-top: 8px; font-weight: bold; color: green; font-size: 16px; }
        .font-indicator { font-size: 12px; color: green; text-align: right; margin-top:-5px; margin-bottom: 8px; display:none; font-weight:bold; }
        #logoPreview { max-height: 50px; display: block; margin: 5px auto; border: 1px solid #ccc; }
        #bgStatusText { font-size: 12px; color: #4a148c; font-weight: bold; margin-top: 5px; display: none; text-align:center; }

        .copyright-footer {
            margin-top: auto; padding-top: 15px; border-top: 1px solid #ddd;
            text-align: center; font-size: 11px; color: #555; font-family: 'Arial', sans-serif;
        }
        .copyright-name { font-weight: bold; color: #004d40; font-size: 12px; }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="main-layout">
    <div class="sidebar">
        <button class="launch-btn" onclick="openTV()">üñ•Ô∏è 1. ﬁìﬁ©ﬁàﬁ© ﬁêﬁ∞ﬁÜﬁ∞ﬁÉﬁ©ﬁÇﬁ∞ ﬁÄﬁ™ﬁÖﬁ™ﬁàﬁß</button>
        <div id="connStatus" style="margin-top:0px; font-size:12px; color:red; font-weight:bold; text-align:center; margin-bottom:10px;">Not Connected</div>

        <div class="file-box">
            <label>1. ﬁÜﬁÆﬁÇﬁ∞ﬁìﬁ¨ﬁÇﬁ∞ﬁìﬁ∞ ﬁçﬁ®ﬁêﬁ∞ﬁìﬁ∞ (CSV/Txt):</label>
            <input type="file" id="csvFile" accept=".csv, .txt">
        </div>

        <div class="file-box" style="background:#e0f2f1; border-color:#00695c;">
            <label>2. ﬁîﬁ™ﬁÇﬁ®ﬁàﬁ¶ﬁÉﬁêﬁ®ﬁìﬁ© ﬁçﬁØﬁéﬁØ/ﬁÑﬁ¨ﬁÇﬁ¶ﬁÉ:</label>
            <input type="file" id="logoInput" accept="image/*">
            <img id="logoPreview" src="" style="display:none;">
        </div>

        <div class="file-box" style="border: 1px solid #2196f3; background: #e3f2fd;">
            <label style="color:#0d47a1">3. ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞ ﬁêﬁ¨ﬁìﬁ®ﬁÇﬁ∞ﬁéﬁ∞ﬁêﬁ∞:</label>
            <label style="font-size:11px">A. ﬁâﬁ¶ﬁáﬁ® ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞ (ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®/ﬁáﬁ¶ﬁÉﬁ¶ﬁÑﬁ®):</label>
            <input type="file" id="font1" accept=".ttf, .otf">
            <div id="f1Stat" class="font-indicator">‚úÖ Loaded & Applied</div>

            <label style="font-size:11px">B. ﬁáﬁ®ﬁÇﬁéﬁ®ﬁÉﬁ≠ﬁêﬁ® ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞:</label>
            <input type="file" id="font2" accept=".ttf, .otf">
            <div id="f2Stat" class="font-indicator">‚úÖ Loaded</div>

            <label style="font-size:11px">C. ﬁáﬁ®ﬁåﬁ™ﬁÉﬁ™ ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞:</label>
            <input type="file" id="font3" accept=".ttf, .otf">
            <div id="f3Stat" class="font-indicator">‚úÖ Loaded</div>
        </div>

        <div class="file-box" style="background:#f3e5f5; border-color:#8e24aa;">
            <label style="color:#4a148c">4. ﬁÑﬁ¨ﬁÜﬁ∞ﬁéﬁ∞ﬁÉﬁ¶ﬁáﬁ™ﬁÇﬁ∞ﬁëﬁ∞ (ﬁäﬁÆﬁìﬁØ / ﬁàﬁ©ﬁëﬁ®ﬁáﬁØ):</label>
            <input type="file" id="bgInput" accept="image/*, video/*">
            <div id="bgStatusText"></div>
        </div>

        <label>ﬁçﬁ®ﬁêﬁ∞ﬁìﬁ™ﬁÇﬁ∞ ﬁÄﬁØﬁãﬁß:</label>
        <input type="text" id="search" placeholder="Search..." onkeyup="filterList()" style="font-size:14px; padding:5px; margin-bottom:5px;">
        <select id="stuList" size="5" onchange="loadStudent()"></select>

        <div class="copyright-footer">
            &copy; Copyright Reserved<br>
            <span class="copyright-name">Ali Ibrahim Didi (7791550)</span>
        </div>
    </div>

    <div class="editor">
        <h2>üéì ﬁÜﬁÆﬁÇﬁ∞ﬁìﬁ∞ﬁÉﬁØﬁçﬁ∞ ﬁïﬁ¨ﬁÇﬁ¶ﬁçﬁ∞</h2>
        <label style="text-align:center">ﬁâﬁ¶ﬁáﬁ® ﬁêﬁ™ﬁÉﬁ™ﬁöﬁ© / Main Heading:</label>
        <input id="titleInput" class="dhi" placeholder="ﬁâﬁ¶ﬁáﬁ® ﬁêﬁ™ﬁÉﬁ™ﬁöﬁ© ﬁçﬁ®ﬁîﬁ™ﬁáﬁ∞ﬁàﬁß...">

        <label style="text-align:center; font-size:12px; color:#555;">ﬁêﬁ¶ﬁÑﬁ∞ ﬁÄﬁ¨ﬁëﬁ®ﬁÇﬁ∞ﬁé ﬁåﬁ¶ﬁáﬁ∞ (ﬁÑﬁ≠ﬁÇﬁ™ﬁÇﬁ∞ ﬁÇﬁ¶ﬁâﬁ¶):</label>
        <input id="sub1" class="dhi sub-input" placeholder="ﬁêﬁ¶ﬁÑﬁ∞ ﬁÄﬁ¨ﬁëﬁ®ﬁÇﬁ∞ﬁé 1">
        <input id="sub2" class="dhi sub-input" placeholder="ﬁêﬁ¶ﬁÑﬁ∞ ﬁÄﬁ¨ﬁëﬁ®ﬁÇﬁ∞ﬁé 2">
        <input id="sub3" class="dhi sub-input" placeholder="ﬁêﬁ¶ﬁÑﬁ∞ ﬁÄﬁ¨ﬁëﬁ®ﬁÇﬁ∞ﬁé 3">

        <label style="text-align:center">ﬁâﬁ¶ﬁáﬁ®ﬁéﬁ¶ﬁÇﬁëﬁ™ ﬁçﬁ®ﬁîﬁ™ﬁÇﬁ∞ / Content:</label>
        <textarea id="mainContent" class="dhi" placeholder="ﬁçﬁ®ﬁîﬁ™ﬁÇﬁ∞ﬁÜﬁÆﬁÖﬁ™ ﬁâﬁ®ﬁåﬁ¶ﬁÇﬁ¶ﬁÅﬁ∞..."></textarea>
        
        <div class="controls">
            <button class="action btn-nav" onclick="move(-1)">‚óÄ Prev</button>
            <button class="action btn-live" onclick="updateTV()">üì∫ ﬁìﬁ©ﬁàﬁ©ﬁáﬁ¶ﬁÅﬁ∞ ﬁáﬁ¶ﬁÉﬁ™ﬁàﬁß</button>
            <button class="action btn-nav" onclick="move(1)">Next ‚ñ∂</button>
            <button class="action btn-clear" onclick="clearTV()" title="Clear Text">X</button>
        </div>
        <div id="statusMsg">Ready</div>
    </div>
</div>

<script>
    // --- SECURITY SCRIPT ---
    document.onkeydown = function(e) {
        if(event.keyCode == 123) return false;
        if(e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0))) return false;
        if(e.ctrlKey && (e.keyCode == 'U'.charCodeAt(0) || e.keyCode == 'S'.charCodeAt(0))) return false;
    }

    // --- MAIN VARS ---
    let tvWindow = null;
    let contentList = [];
    let uploadedLogo = null;
    let bgType = 'none'; let bgData = null; 
    let fonts = { f1: null, f2: null, f3: null };

    // --- TV SCREEN GENERATION ---
    function openTV() {
        tvWindow = window.open('', 'RoyalLogoTV', 'width=1280,height=720,menubar=no,toolbar=no');
        if(!tvWindow) { alert("‚ö†Ô∏è Please Allow Popups!"); return; }

        const designHTML = `
        <!DOCTYPE html>
        <html lang="dv" dir="rtl">
        <head>
            <meta charset="UTF-8">
            <style id="dynamic-font-styles">
                @font-face { font-family: 'Faruuma'; src: local('Faruuma'); }
                body { font-family: 'Faruuma', sans-serif; }
            </style>
            <style>
                body { 
                    margin: 0; padding: 0; overflow: hidden; height: 100vh; width: 100vw;
                    background-color: #002a20; 
                    background-image: radial-gradient(circle at center, #003d2e 0%, #001812 100%);
                    background-size: cover; background-position: center;
                    display: flex; justify-content: center; align-items: center;
                    user-select: none;
                }

                #bgVideo {
                    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                    object-fit: cover; z-index: -1; display: none;
                }

                /* FULLSCREEN BUTTON */
                #fsOverlay {
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0,0,0,0.8); z-index: 9999;
                    display: flex; justify-content: center; align-items: center;
                    flex-direction: column;
                }
                #fsBtn {
                    padding: 20px 40px; font-size: 25px; font-weight: bold;
                    background: #28a745; color: white; border: none; border-radius: 10px;
                    cursor: pointer; box-shadow: 0 0 20px #28a745;
                    font-family: sans-serif;
                }
                #fsBtn:hover { transform: scale(1.05); }

                .logo-container {
                    position: absolute; top: 20px; left: 0; right: 0;
                    text-align: center; z-index: 10; padding: 0 20px;
                }
                #displayLogo {
                    max-height: 80px; max-width: 40%; object-fit: contain;
                    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5)); display: none; 
                }

                .corner { position: absolute; width: 250px; height: 250px; pointer-events: none; z-index: 20; }
                .bottom-left { bottom: 30px; left: 30px; transform: rotate(180deg); }

                .line-outer {
                    position: absolute; top: 0; right: 0; width: 60px; height: 60px; 
                    border-top: 10px solid #b8860b; border-right: 10px solid #b8860b;
                    box-shadow: 2px -2px 5px rgba(0,0,0,0.5);
                }
                .line-inner {
                    position: absolute; top: 20px; right: 20px; width: 140px; height: 140px; 
                    border-top: 3px solid #ffd700; border-right: 3px solid #ffd700;
                    box-shadow: 1px -1px 3px rgba(0,0,0,0.5);
                }

                .content-wrapper {
                    width: 75%; max-width: 1300px; max-height: 65vh; 
                    margin-top: 40px; margin-bottom: 50px; 
                    padding: 40px; text-align: center;
                    display: flex; flex-direction: column; 
                    justify-content: center; align-items: center;

                    background: rgba(0, 30, 20, 0.45);
                    border: 1px solid rgba(255, 215, 0, 0.15);
                    border-radius: 25px; backdrop-filter: blur(4px); z-index: 5; 
                    opacity: 0; transform: scale(0.95);
                    transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
                }
                .content-wrapper.active { opacity: 1; transform: scale(1); }

                h1 { 
                    font-size: 3.5em; margin: 0 0 10px 0; color: #ffd700; 
                    text-shadow: 0 4px 8px rgba(0,0,0,0.8);
                    border-bottom: 2px solid rgba(184, 134, 11, 0.5);
                    display: inline-block; padding-bottom: 10px;
                    line-height: 1.1; width: 100%;
                }

                .sub-headers {
                    display: flex; flex-direction: column; gap: 5px; width: 100%;
                    margin-bottom: 15px;
                }
                .sub-h {
                    font-size: 2em; color: #fff9c4; margin: 0; padding: 0;
                    text-shadow: 1px 1px 3px black;
                }
                
                .content-body {
                    font-size: 3em; color: #fff; line-height: 1.4; font-weight: normal;
                    text-shadow: 2px 2px 4px rgba(0,0,0,1);
                    width: 100%; white-space: pre-wrap; word-wrap: break-word; 
                }
            </style>
        </head>
        <body oncontextmenu="return false;">
            
            <div id="fsOverlay">
                <button id="fsBtn" onclick="goFull()">CLICK TO START FULLSCREEN</button>
                <div style="color:white; margin-top:10px; font-family:sans-serif;">(This removes the menu bar)</div>
            </div>

            <video id="bgVideo" autoplay loop muted playsinline></video>

            <div class="logo-container"><img id="displayLogo" src=""></div>
            <div class="corner bottom-left"><div class="line-outer"></div><div class="line-inner"></div></div>

            <div id="wrapper" class="content-wrapper">
                <h1 id="tvTitle"></h1>
                <div id="subContainer" class="sub-headers">
                    <div id="tvSub1" class="sub-h"></div>
                    <div id="tvSub2" class="sub-h"></div>
                    <div id="tvSub3" class="sub-h"></div>
                </div>
                <div id="tvContent" class="content-body"></div>
            </div>

            <script>
                function goFull() {
                    document.documentElement.requestFullscreen().catch(e => console.log(e));
                    document.getElementById('fsOverlay').style.display = 'none';
                }
                document.ondblclick = function() {
                    document.documentElement.requestFullscreen().catch(e => console.log(e));
                }
            <\/script>
        </body>
        </html>`;

        tvWindow.document.write(designHTML);
        tvWindow.document.close();
        
        updateTVFonts();
        updateTVLogo();
        updateTVBackground();

        document.getElementById('connStatus').innerText = "‚úÖ Connected";
        document.getElementById('connStatus').style.color = "green";
    }

    // --- HELPER FUNCTIONS ---
    function loadFont(file, key, statId) {
        if(!file) return;
        const reader = new FileReader();
        reader.onload = evt => {
            fonts[key] = evt.target.result;
            document.getElementById(statId).style.display = 'block';
            if(key === 'f1') updateControlPanelFont(fonts.f1);
            updateTVFonts();
        };
        reader.readAsDataURL(file);
    }
    function updateControlPanelFont(fontData) {
        document.getElementById('ctrl-font-style').innerHTML = `
            @font-face { font-family: 'UploadedMain'; src: url('${fontData}') format('truetype'); }
            body, input, textarea, select, button { font-family: 'UploadedMain', 'Faruuma', sans-serif !important; }
        `;
    }
    function updateTVFonts() {
        if(!tvWindow || tvWindow.closed) return;
        let fontFaces = "", fontFamilies = "'Faruuma'"; 
        if(fonts.f1) { fontFaces += `@font-face { font-family: 'CF1'; src: url('${fonts.f1}') format('truetype'); } `; fontFamilies = "'CF1', " + fontFamilies; }
        if(fonts.f2) { fontFaces += `@font-face { font-family: 'CF2'; src: url('${fonts.f2}') format('truetype'); } `; fontFamilies = "'CF2', " + fontFamilies; }
        if(fonts.f3) { fontFaces += `@font-face { font-family: 'CF3'; src: url('${fonts.f3}') format('truetype'); } `; fontFamilies = "'CF3', " + fontFamilies; }
        fontFamilies += ", 'Times New Roman', serif";
        if(tvWindow.document.getElementById('dynamic-font-styles'))
            tvWindow.document.getElementById('dynamic-font-styles').innerHTML = `${fontFaces} body, h1, .sub-h, .content-body, input, textarea { font-family: ${fontFamilies} !important; }`;
    }
    document.getElementById('font1').onchange = e => loadFont(e.target.files[0], 'f1', 'f1Stat');
    document.getElementById('font2').onchange = e => loadFont(e.target.files[0], 'f2', 'f2Stat');
    document.getElementById('font3').onchange = e => loadFont(e.target.files[0], 'f3', 'f3Stat');

    document.getElementById('logoInput').onchange = e => {
        const file = e.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = evt => { uploadedLogo = evt.target.result; document.getElementById('logoPreview').src = uploadedLogo; document.getElementById('logoPreview').style.display = 'block'; updateTVLogo(); };
        reader.readAsDataURL(file);
    }
    function updateTVLogo() { if(tvWindow && !tvWindow.closed && uploadedLogo) { const img = tvWindow.document.getElementById('displayLogo'); img.src = uploadedLogo; img.style.display = 'inline-block'; }}

    document.getElementById('bgInput').onchange = e => {
        const file = e.target.files[0]; if(!file) return;
        const statText = document.getElementById('bgStatusText');
        if (file.type.startsWith('image/')) {
            bgType = 'image'; const reader = new FileReader();
            reader.onload = evt => { bgData = evt.target.result; statText.innerText = "‚úÖ Image/GIF Set"; statText.style.display = "block"; updateTVBackground(); };
            reader.readAsDataURL(file);
        } else if (file.type.startsWith('video/')) {
            bgType = 'video'; bgData = URL.createObjectURL(file); statText.innerText = "‚úÖ Video Set"; statText.style.display = "block"; updateTVBackground();
        }
    }
    function updateTVBackground() {
        if(!tvWindow || tvWindow.closed) return;
        const body = tvWindow.document.body; const vid = tvWindow.document.getElementById('bgVideo');
        if(bgType === 'image') { vid.style.display = 'none'; vid.pause(); body.style.backgroundImage = `url('${bgData}')`; body.style.backgroundSize = "cover"; body.style.backgroundPosition = "center"; } 
        else if (bgType === 'video') { body.style.backgroundImage = 'none'; vid.src = bgData; vid.style.display = 'block'; vid.play().catch(e => console.log("Autoplay waiting")); }
    }

    function updateTV() {
        if(!tvWindow || tvWindow.closed) { alert("TV Closed! Re-open."); return; }
        const doc = tvWindow.document;
        try {
            doc.getElementById('tvTitle').textContent = document.getElementById('titleInput').value;
            doc.getElementById('tvContent').textContent = document.getElementById('mainContent').value;
            const s1=doc.getElementById('tvSub1'), v1=document.getElementById('sub1').value; s1.textContent=v1; s1.style.display=v1?'block':'none';
            const s2=doc.getElementById('tvSub2'), v2=document.getElementById('sub2').value; s2.textContent=v2; s2.style.display=v2?'block':'none';
            const s3=doc.getElementById('tvSub3'), v3=document.getElementById('sub3').value; s3.textContent=v3; s3.style.display=v3?'block':'none';
            const w = doc.getElementById('wrapper'); w.classList.remove('active'); void w.offsetWidth; w.classList.add('active');
            if(uploadedLogo) updateTVLogo(); updateTVBackground();
            document.getElementById('statusMsg').innerText = "On Air"; document.getElementById('statusMsg').style.color = "green";
        } catch (err) { console.error(err); }
    }

    function clearTV() { if(tvWindow && !tvWindow.closed) { tvWindow.document.getElementById('wrapper').classList.remove('active'); document.getElementById('statusMsg').innerText = "Cleared"; document.getElementById('statusMsg').style.color = "orange"; } }

    document.getElementById('csvFile').onchange = e => {
        const r = new FileReader();
        r.onload = ev => {
            let txt = ev.target.result; let lines = txt.split('\n'); contentList = [];
            lines.forEach(l => {
                let parts = l.split(',');
                if(parts.length >= 1 && parts[0].trim() !== "") {
                    contentList.push({ title: parts[0]||"", sub1: parts[1]||"", sub2: parts[2]||"", sub3: parts[3]||"", body: parts.slice(4).join(',')||"" });
                }
            });
            filterList(); alert("Loaded " + contentList.length + " items.");
        }; r.readAsText(e.target.files[0]);
    };
    function filterList() {
        let t = document.getElementById('search').value.toLowerCase(); let l = document.getElementById('stuList'); l.innerHTML = '';
        contentList.forEach((s,i) => {
            let label = s.title ? s.title : s.body.substring(0, 30) + "...";
            if(label.toLowerCase().includes(t)) { let o = document.createElement('option'); o.value=i; o.text=(i+1)+". "+label; l.add(o); }
        });
    }
    function loadStudent() {
        let s = contentList[document.getElementById('stuList').value];
        document.getElementById('titleInput').value = s.title; document.getElementById('sub1').value = s.sub1;
        document.getElementById('sub2').value = s.sub2; document.getElementById('sub3').value = s.sub3;
        document.getElementById('mainContent').value = s.body;
    }
    function move(d) {
        let l = document.getElementById('stuList');
        if(l.options.length) { l.selectedIndex = Math.min(Math.max(l.selectedIndex+d, 0), l.options.length-1); loadStudent(); }
    }
</script>
</body>
</html>
